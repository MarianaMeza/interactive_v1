<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Basic Bar Chart</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    /* custom css styles will go here */

    </style>
</head>
<body>
    <p>In 2017, there where 31,902 violent homicides in Mexico</p>
    <p>Each square represents 10 homicides. Scroll down to learn more</p>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script>

// For some reason does not work in the index.js
  var margin = {top:10,right:100,bottom:30,left:100},
      width  = 800 - margin.left - margin.right,
      height = 700 - margin.top - margin.bottom,
      //boxSize = 1 // full dataset
      boxSize = 10, //size of each box sample dataset
    //  boxGap = 0.1 // full dataset
      boxGap = 3, //space between each box
      howManyAcross = Math.floor(width / boxSize);

  // trying to load dataset



    var svg = d3.select("body")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("viewBox", "0 0 " + (width + margin.left + margin.right) + " " + (height + margin.top + margin.bottom));

  //  need to transition between these variables
  //  var categoryHeading = "age_r"
  //  var categoryHeading = "cause_r"
  //  var categoryHeading = "educ_r"
  //  var categoryHeading = "sex"
    var categoryHeading = "location_r"
    var g = svg.append("g")
            .attr("transform","translate(" + margin.left + "," + margin.top + ")");

        //rainbow colors
    var colors = d3.scaleSequential(d3.interpolateRdBu);
    //sample
  d3.csv('homicide_sample.csv').then(function(data, i){
    // full
  // d3.csv('homicide_full.csv').then(function(data, i){

         //sort data alphabetically
         data.sort(function(a,b){ return d3.ascending(a[categoryHeading], b[categoryHeading])});

         //get all of the unique values in the column for the scale
         var keys = d3.map(data, function(d){ return d[categoryHeading];}).keys();

         //set domain on category
         colors.domain([0, keys.length]);

         //convert to a categorical scale
         var categoryScale = d3.scaleOrdinal(keys.map(function(d, i){ return colors(i);}));
         categoryScale.domain(keys);//set the scale domain


         //make the main chart

         g.selectAll(".square")
             .data(data)
             .enter()
             .append("rect")
             .attr("class", "square")
             .attr("x", function(d,i){ return boxSize * (i % howManyAcross); })
             .attr("y", function(d,i){ return Math.floor(i/howManyAcross) * boxSize; })
             .attr("width", boxSize - 3)
             .attr("height", boxSize - 3)
             .attr("fill", "black")
             .transition()
             .duration(5000)
             .attr("fill", function(d){ return categoryScale(d[categoryHeading]);})
             .transition()
             .duration(2000)
             .attr("fill", "grey")
             //.exit();


         //legend
         var legend = svg.selectAll(".legend")
             .data(keys)
             .enter();


         legend.append("rect")
             .attr("x", margin.left + width + boxGap )
             .attr("y", function(d,i){ return (i * boxSize) + margin.top; })
             .attr("width", boxSize - 3)
             .attr("height", boxSize - 3)
             .attr("fill", function(d){ return categoryScale(d); })

         legend.append("text")
             .attr("x", margin.left + width + boxSize + (boxGap*2))
             .attr("y", function(d,i){ return (i * boxSize) + margin.top; })
             .append("tspan")
             .attr("dx", 0)
             .attr("dy", boxSize/2)
             .style("alignment-baseline", "middle")
             .style("font-size", 10)
             .style("font-family", "Helvetica, Arial, sans-serif")
             .text(function(d){ return d;})
     });

    </script>
</body>
</html>
